(()=>{"use strict";class t{x;y;z;w;constructor(t,s,i=0,e=0){this.x=t,this.y=s,this.z=i,this.w=e}copy(){return new t(this.x,this.y,this.z,this.w)}rotateZ(t){const s=Math.cos(t),i=Math.sin(t),{x:e,y:h}=this;return this.x=s*e-i*h,this.y=i*e+s*h,this}translateX(t){return this.x+=t,this}translateY(t){return this.y+=t,this}translateZ(t){return this.z+=t,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}multiply(t){return this.x*=t,this.y*=t,this.z*=t,this}divide(t){return this.x/=t,this.y/=t,this.z/=t,this}normalize(){const t=Math.sqrt(this.x**2+this.y**2+this.z**2);return this.divide(t)}distance(t,s){return this.dot(s)-s.dot(t)}lerp(s,i,e){const h=t.add(t.multiply(t.subtract(i,s),e),s);return this.x=h.x,this.y=h.y,this.z=h.z,this}static fromPolar(s,i){return new t(s*Math.cos(i),s*Math.sin(i))}static toPolar(t){return{r:Math.sqrt(t.x**2+t.y**2),theta:Math.atan2(t.y,t.x)}}static angle(s,i){const e=t.subtract(i,s);return Math.atan2(e.y,e.x)}static intersectPlane(t,s,i,e){const h=-(s=s.normalize()).dot(t),n=i.dot(s),r=(-h-n)/(e.dot(s)-n),a=e.subtract(i).multiply(r);return i.add(a)}static add(s,i){return new t(s.x+i.x,s.y+i.y,s.z+i.z)}static subtract(s,i){return new t(s.x-i.x,s.y-i.y,s.z-i.z)}static multiply(s,i){return new t(s.x*i,s.y*i,s.z*i)}static divide(s,i){return new t(s.x/i,s.y/i,s.z/i)}static normalize(s){const i=Math.sqrt(s.x**2+s.y**2+s.z**2);return t.divide(s,i)}static lerp(s,i,e){return t.add(t.multiply(t.subtract(i,s),e),s)}static distance(s,i){const e=t.subtract(i,s);return Math.sqrt(e.x**2+e.y**2+e.z**2)}}class s{#t;#s;userData;constructor(t){this.#t=[],this.#s=t,window.addEventListener("keydown",(t=>{const s=t.code;this.pressed.includes(s)||this.pressed.push(s)})),window.addEventListener("keyup",(t=>{const s=t.code;if(this.pressed.includes(s)){const t=this.pressed.indexOf(s);-1!==t&&this.pressed.splice(t,1)}}))}control(){for(const t in this.handler)this.pressedKey(t)&&this.handler[t](this.userData)}pressedKey(t){return this.pressed.includes(t)}get pressed(){return this.#t}get handler(){return this.#s}}class i{start;end;constructor(t,s){this.start=t,this.end=s}lerp(s){return t.lerp(this.start,this.end,s)}intersect(t){return i.intersect(this,t)}reflect(s){const i=this.normal.multiply(s.dot(this.normal)),e=t.subtract(s,i);return i.multiply(-1).add(e)}get length(){return t.distance(this.start,this.end)}get center(){return t.subtract(this.end,this.start).divide(2).add(this.start)}get normal(){const s=t.subtract(this.end,this.start);return new t(-s.y,s.x).normalize()}static intersect(t,s){const i=(s.end.x-s.start.x)*(t.start.y-s.start.y)-(s.end.y-s.start.y)*(t.start.x-s.start.x),e=(s.start.y-t.start.y)*(t.start.x-t.end.x)-(s.start.x-t.start.x)*(t.start.y-t.end.y),h=(s.end.y-s.start.y)*(t.end.x-t.start.x)-(s.end.x-s.start.x)*(t.end.y-t.start.y);if(0===h)return null;const n=i/h,r=e/h;return n>=0&&n<=1&&r>=0&&r<=1?{point:t.lerp(n),offset1:n,offset2:r}:void 0}}class e{track;position;size;#i;#e;#h;#n;#r;#a;#o;#l;constructor({canvas:s,controller:e}){this.#h=s,this.#a=e,this.#a.userData=this,this.position=new t(0,0),this.size=0,this.#i=0,this.#e=0,this.#n=[],this.#r=0,this.#o=.5,this.#l={top:new i(new t(0,0),new t(0,0)),bottom:new i(new t(0,0),new t(0,0)),right:new i(new t(0,0),new t(0,0)),left:new i(new t(0,0),new t(0,0))},this.t=.5,this.track=new i(new t(0,0),new t(0,0))}#c(){this.position=t.lerp(this.track.start,this.track.end,this.t);const s=this.position.x-.5*this.width,e=this.position.x+.5*this.width,h=this.position.y-1.5*this.height,n=this.position.y-.5*this.height;this.#n=[new t(s,h),new t(e,h),new t(e,n),new t(s,n)];for(const t of this.#n)t.subtract(this.position),t.rotateZ(this.#r),t.add(this.position);const[r,a,o,l]=this.#n;this.#l={top:new i(r,a),bottom:new i(l,r),right:new i(a,l),left:new i(o,r)}}update(){this.#a.control(),this.#c()}goRight(){this.t+=.01}goLeft(){this.t-=.01}draw(t=!1){this.canvas.line(this.track.start,this.track.end).stroke({color:"#f00"}),this.canvas.beginPath().moveTo(this.#n[0]);for(let t=1;t<this.#n.length;t++)this.canvas.lineTo(this.#n[t]);if(this.canvas.closePath().fill(),t){const t=7,s=Array.from({length:t},((s,i)=>i/(t-1)));for(const t of s){const s=this.#l.top.lerp(t),i=this.getBounceVector(t).multiply(50).add(s);this.canvas.line(s,i).stroke({color:"#ff0"}),this.canvas.circle(s,3).fill("red")}}}resize(s,i){this.track.start=s,this.track.end=i,this.#r=t.angle(this.track.start,this.track.end),this.size=.25*this.track.length,this.#i=this.size,this.#e=.1*this.size,this.#c()}getBounceVector(s){const i=.0625+.875*s;return t.fromPolar(1,this.#r+Math.PI*i-Math.PI)}set t(t){this.#o=Math.min(Math.max(t,.125),.875)}get t(){return this.#o}get canvas(){return this.#h}get width(){return this.#i}get height(){return this.#e}get top(){return this.#l.top}get bottom(){return this.#l.bottom}get left(){return this.#l.left}get right(){return this.#l.right}}class h{#h;#d=new t(1,1);#u;#g=5;#p=new i(new t(0,0),new t(0,0));#f;#y=new t(0,0);#x;#w;constructor({size:s,canvas:e,pong:h}){this.#h=e,this.#f=s,this.#u=h,this.#x=this.canvas.center.copy(),this.reset(),this.#w=[];const n=2*Math.PI/8;for(let s=n;s<=2*Math.PI;s+=n)this.#w.push(new i(this.#x,t.fromPolar(this.#f,+s.toFixed(4)).add(this.#x)))}reset(){const s=Math.random()*Math.PI*2;this.#d=t.fromPolar(1,s),this.#g=5,this.#y=t.multiply(this.#d,this.#g),this.#x.x=0,this.#x.y=0,this.#p=new i(this.canvas.center,this.#x),this.#w&&this.#m()}#m(){let s=0;const i=2*Math.PI/8;for(const e of this.#w)e.end=t.fromPolar(this.#f,s).add(this.#x),s+=i}#b(){for(const s of[this.#p,...this.#w]){for(const e of this.#u.boundaries){const h=i.intersect(s,e);if(h)return this.#x.subtract(t.subtract(s.end,s.start).multiply(1-h.offset1)),this.#d=e.reflect(this.#d),void(this.#y=t.multiply(this.#d,this.#g))}for(const e of this.#u.paddles){const h=i.intersect(s,e.top);if(h)return this.#x.subtract(t.subtract(s.end,s.start).multiply(1-h.offset1)),this.#d=e.getBounceVector(h.offset2),void(this.#y=t.multiply(this.#d,this.#g));if(i.intersect(s,e.track))return this.reset(),void this.#u.pause()}}}update(){this.#x.add(this.#y),this.#m(),this.#b()}draw(t=!1){this.canvas.circle(this.#x,this.#f).fill(),t&&this.#v()}#v(){this.canvas.line(this.#x,t.multiply(this.#d,Math.max(innerWidth,innerHeight)).add(this.#x)).stroke({color:"#0f0"});for(const t of this.#w)this.canvas.line(t.start,t.end).stroke({color:"#f00"})}get canvas(){return this.#h}}const n=new class{#h;#z=[];#n=[];#P;#k;#M;#S=!1;constructor({canvas:t,ballSize:i,playerCount:n}){this.#h=t,this.#k=[];for(let t=0;t<n;t++)this.#k.push(new e({canvas:this.canvas,controller:new s({ArrowRight:function(t){t.goRight()},ArrowLeft:function(t){t.goLeft()}})}));this.#D(),this.#M=new h({size:i/(.5*n),canvas:this.canvas,pong:this}),this.#P=!1}#D(){this.#z=[],this.#n=[];const s=Math.min(.5*this.canvas.width,.5*this.canvas.height),e=2*Math.PI/this.#k.length;for(let i=0;i<2*Math.PI;i=+(i+e).toFixed(4)){const h=.5*Math.PI,n=+i.toFixed(4)+h,r=.2*e,a=n-r,o=n+r;this.#n.push(t.fromPolar(s,a)),this.#n.push(t.fromPolar(s,o))}for(let t=0;t<this.#n.length;t++){const s=(t+1)%this.#n.length,e=new i(this.#n[t],this.#n[s]);t%2==0?this.#k[t/2].resize(e.end,e.start):this.#z.push(e)}}resize(t,s){this.canvas.resize(t,s),this.#D()}update(){this.#M.update();for(const t of this.#k)t.update()}draw(){this.canvas.clear();for(const t of this.#z)this.canvas.line(t.start,t.end).stroke({color:"#fff"});this.#M.draw(this.#S);for(const t of this.#k)t.draw(this.#S)}#A(){this.update(),this.draw(),this.#P&&requestAnimationFrame(this.#A.bind(this))}play(){this.#P=!0,this.#A()}pause(){this.#P=!1}set debug(t){this.#S=!!t}get debug(){return this.#S}get canvas(){return this.#h}get boundaries(){return this.#z}get isPlaying(){return this.#P}get paddles(){return this.#k}}({canvas:new class{id;ctx;center;top=0;bottom=0;left=0;right=0;#I;#B;#T;#W;#L;#O;#q;#E;#R;#V;constructor({id:s,width:i,height:e}){this.id=s,this.#V=document.getElementById(s),this.ctx=this.element.getContext("2d"),this.fillStyle="#fff",this.strokeStyle="#fff",this.lineWidth=1,this.lineDash=[],this.lineDashOffset=0,this.center=new t(0,0),this.resize(i,e)}resize(t,s){return this.width=t,this.height=s,this.top=-.5*s,this.bottom=.5*s,this.left=-.5*t,this.right=.5*t,this.onResize(),this}drawImage(t,s,i,e){return this.ctx.drawImage(t,s.x+this.right,s.y+this.bottom,i,e),this}rotateAndDrawImage(t,s,i,e,h){return this.save().translate(s).rotate(-h).drawImage(t,{x:-i/2,y:-e/2},i,e).restore(),this}circle(t,s){return this.beginPath(),this.ctx.arc(t.x+this.right,t.y+this.bottom,s,0,2*Math.PI),this.closePath(),this}rect(t,s,i){return this.ctx.rect(t.x+this.right-.5*s,t.y+this.bottom-.5*i,s,i),this.closePath(),this}polygon(s,i,e){const h=2*Math.PI/i;this.beginPath().moveTo(t.fromPolar(e,0).add(s));for(let i=h;i<2*Math.PI;i+=h)this.lineTo(t.fromPolar(e,i).add(s));return this.closePath(),this}line(t,s){return this.beginPath(),this.ctx.moveTo(t.x+this.right,t.y+this.bottom),this.ctx.lineTo(s.x+this.right,s.y+this.bottom),this.closePath(),this}moveTo(t){return this.ctx.moveTo(t.x+this.right,t.y+this.bottom),this}lineTo(t){return this.ctx.lineTo(t.x+this.right,t.y+this.bottom),this}text({text:t,at:s,fillStyle:i=this.#I,strokeStyle:e=this.#B,size:h=16}){this.beginPath(),this.textAlign="center",this.textBaseline="middle",this.fillStyle=i,this.strokeStyle=e,this.font=`${h}px Arial`,this.ctx.fillText(t,s.x+this.right,s.y+this.bottom),this.ctx.strokeText(t,s.x+this.right,s.y+this.bottom)}beginPath(){return this.ctx.beginPath(),this}closePath(){return this.ctx.closePath(),this}stroke({color:t=this.#B,width:s=this.#T,dash:i=this.#W}={}){return this.strokeStyle=t,this.lineWidth=s,this.lineDash=i,this.ctx.stroke(),this}fill(t="#fff"){return this.fillStyle=t,this.ctx.fill(),this}clear(){return this.element.height=this.height,this}translate(t){return this.ctx.translate(t.x+this.right,t.y+this.bottom),this}rotate(t){return this.ctx.rotate(t),this}save(){return this.ctx.save(),this}restore(){return this.ctx.restore(),this}set fillStyle(t){this.#I=t,this.ctx.fillStyle=t}set strokeStyle(t){this.#B=t,this.ctx.strokeStyle=t}set lineWidth(t){this.#T=t,this.ctx.lineWidth=t}set lineDash(t){this.#W=t,this.ctx.setLineDash(t)}set lineDashOffset(t){this.#L=t,this.ctx.lineDashOffset=t}set width(t){this.element.width=t}set height(t){this.element.height=t}set textAlign(t){this.#O=t,this.ctx.textAlign=t}set textBaseline(t){this.#q=t,this.ctx.textBaseline=t}set font(t){this.#E=t,this.ctx.font=t}set globalAlpha(t){this.#R=t,this.ctx.globalAlpha=t}get element(){return this.#V}get width(){return this.element.width}get height(){return this.element.height}get fillStyle(){return this.#I}get strokeStyle(){return this.#B}get lineWidth(){return this.#T}get lineDash(){return this.#W}get lineDashOffset(){return this.#L}get textAlign(){return this.#O}get textBaseline(){return this.#q}get font(){return this.#E}get globalAlpha(){return this.#R}onResize(){}}({id:"canvas",width:innerWidth,height:innerHeight}),ballSize:10,playerCount:2});n.debug=!1,n.draw(),window.addEventListener("click",(()=>{n.isPlaying?n.pause():n.play()})),window.addEventListener("resize",(()=>{n.resize(innerWidth,innerHeight),n.draw()}))})();